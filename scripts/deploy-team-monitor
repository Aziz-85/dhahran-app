#!/usr/bin/env bash
# Wrapper: run deploy as deploy. Install to /usr/local/bin/deploy-team-monitor.
set -euo pipefail

APP_DIR=/var/www/team-monitor
SCRIPT="$APP_DIR/scripts/deploy-production.sh"

if [[ ! -f "$SCRIPT" ]]; then
  echo "ERROR: Deploy script not found: $SCRIPT" >&2
  exit 1
fi

if [[ "$(id -u)" -eq 0 ]]; then
  exec su - deploy -c "cd $APP_DIR && $SCRIPT"
else
  [[ "$(whoami)" = "deploy" ]] || { echo "Run as root or deploy: sudo deploy-team-monitor" >&2; exit 1; }
  cd "$APP_DIR"
  exec "$SCRIPT"
fi
