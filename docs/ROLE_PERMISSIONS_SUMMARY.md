# تنظيم الصلاحيات في الموقع — لكل دور ماذا يشوف وماذا لا يشوف

هذا المستند يلخص الصلاحيات حسب **الدور (Role)** في التطبيق. مصدر الصلاحيات: `lib/permissions.ts` و `lib/navConfig.ts`.

---

## ملخص سريع بالأدوار

| الدور | الوصف المختصر |
|-------|----------------|
| **EMPLOYEE** | موظف: الداشبورد، صفحته، الجدول (عرض)، المهام، أهدافي، مبيعاتي، المرتجعات، الطلبات، الجرد اليومي والمناطق، حول، تغيير كلمة المرور |
| **ASSISTANT_MANAGER** | مساعد مدير: مثل الموظف + تعديل الجدول + المصفوفة الشهرية + ملخص المبيعات + استيراد ومشاكل الاستيراد + طلبات الإجازات (عرض طلباتي فقط) |
| **MANAGER** | مدير: كل العمليات + Executive + الموافقات + تدقيق الجدول + مهام الفرع + إجازات الفرع + أهداف/طلبات تعديل المبيعات + تفويض + KPI + لا يرى إدارة النظام الكاملة (بوتيكات، مناطق، مستخدمين كامل) |
| **ADMIN** | مدير نظام: كل ما يراه المدير + إدارة البوتيكات/المناطق/المجموعات/العضويات/المستخدمين/قواعد التغطية + الاستيراد + التدقيق + إعدادات النظام |
| **SUPER_ADMIN** | مدير أعلى: نفس ADMIN مع إمكانية الوصول لجميع الفرعين (بدون ربط بفرع واحد) |

---

## 1) EMPLOYEE — الموظف

### يشوف (صفحات وروابط)
- **الداشبورد** `/dashboard`
- **صفحتي** `/employee`
- **جدول الشفتات (عرض فقط)** `/schedule/view`
- **المهام** `/tasks`
- **هدفي** `/me/target`
- **مبيعاتي** `/sales/my`
- **المرتجعات** `/sales/returns`
- **طلبات الإجازات** `/leaves/requests`
- **الجرد اليومي** `/inventory/daily`
- **جرد المناطق** `/inventory/zones`
- **حول** `/about`
- **تغيير كلمة المرور** `/change-password`

### لا يشوف
- الصفحة الرئيسية للمديرين `/`
- **Executive** (كل مسارات `/executive/*`)
- **تعديل الجدول** `/schedule/edit`, `/schedule/editor`
- تدقيق الجدول، الموافقات، مهام الفرع، إجازات الفرع
- ملخص المبيعات، استيراد المبيعات، المصفوفة الشهرية، دفتر المبيعات اليومي
- **كل لوحة الإدارة** `/admin/*` (بوتيكات، مستخدمين، استيراد، إلخ)
- رفع KPI، تصدير بلانر، مزامنة بلانر

---

## 2) ASSISTANT_MANAGER — مساعد المدير

### يشوف
- كل ما يراه **EMPLOYEE**، زائد:
- **تعديل الجدول** `/schedule/edit`, `/schedule/editor` (إذا كانت صلاحية `canEditSchedule` مفعّلة)
- **ملخص المبيعات** `/sales/summary`
- **المرتجعات** `/sales/returns`
- **استيراد المبيعات** `/sales/import`
- **مشاكل الاستيراد** `/sales/import-issues`
- **المصفوفة الشهرية** `/sales/monthly-matrix`

### لا يشوف
- **Executive** (كل `/executive/*`)
- **الصفحة الرئيسية للمديرين** `/`
- **الموافقات** `/approvals`
- تدقيق الجدول `/schedule/audit`, `/schedule/audit-edits`
- مراقبة المهام، إعداد المهام، تصدير/مزامنة بلانر
- إجازات الفرع، مهام الفرع، جرد المتابعة، تاريخ الجرد اليومي
- **كل لوحة الإدارة** `/admin/*`
- **مبيعاتي** `/sales/my` (للموظف فقط في القائمة، لكن المسار قد يكون مسموحاً حسب ROLE_ROUTES — مساعد المدير عنده sales/summary و returns و import و monthly-matrix وليس sales/my)

ملاحظة: طلبات الإجازات لمساعد المدير تبقى تحت «طلباتي»؛ الموافقة على الأسبوع تحتاج صلاحية `canApproveWeek` (عادة للمدير/الأدمن).

---

## 3) MANAGER — المدير

### يشوف
- **الصفحة الرئيسية** `/`
- **الداشبورد** `/dashboard`
- **Executive** (كل المسارات): `/executive`, `/executive/monthly`, `/executive/insights`, `/executive/compare`, `/executive/employees`
- **الموافقات** `/approvals` (إذا كان `canApproveWeek` مفعّلاً)
- **الجدول**: عرض، تعديل، تدقيق، تدقيق التعديلات
- **المهام**: المهام، مراقبة المهام، إعداد المهام
- **تصدير بلانر** `/planner-export`
- **مزامنة بلانر** `/sync/planner`
- **الإجازات**: إجازات الفرع، طلبات الإجازات (حسب الروابط)
- **المبيعات**: دفتر يومي، ملخص، مرتجعات، استيراد، مشاكل استيراد، مصفوفة شهرية
- **الأهداف وطلبات التعديل**: `/admin/targets`, `/admin/sales-edit-requests`
- **الجرد**: يومي، تاريخ، مناطق، متابعة
- **مهام الفرع** `/boutique/tasks`
- **التفويض** `/admin/control-panel/delegation`
- **الموظفين (إدارة)** `/admin/employees`
- **رفع KPI** `/kpi/upload`
- **هدفي**، **حول**، **تغيير كلمة المرور**

### لا يشوف
- **إدارة النظام الكاملة**: بوتيكات، مناطق، مجموعات بوتيكات، عضويات، **مستخدمين**، قواعد تغطية (هذه للأدمن فقط في القائمة)
- **استيراد النظام**: `/admin/import`, لقطة شهرية، استيراد تاريخي
- **إعدادات النظام**: `/admin/system`, إصدار، تدقيق النظام، تدقيق تسجيل الدخول

في الكود: المدير له في ROLE_ROUTES: admin/employees, admin/targets, admin/sales-edit-requests, admin/control-panel/delegation — ولا يظهر له في القائمة روابط admin/boutiques, admin/users, admin/coverage-rules, admin/import, admin/audit/login (لأنها محددة لأدوار ADMIN و SUPER_ADMIN في navConfig).

---

## 4) ADMIN — مدير النظام

### يشوف
- كل ما يراه **MANAGER**، زائد:
- **إدارة البوتيكات** `/admin/boutiques`
- **المناطق** `/admin/regions`
- **مجموعات البوتيكات** `/admin/boutique-groups`
- **العضويات** `/admin/memberships`
- **المستخدمين** `/admin/users`
- **قواعد التغطية** `/admin/coverage-rules`
- **الاستيراد** `/admin/import`
- **لقطة شهرية** `/admin/import/month-snapshot`
- **استيراد تاريخي** `/admin/historical-import`
- **تدقيق تسجيل الدخول** `/admin/audit/login`
- **إعدادات النظام** `/admin/system`
- **الإصدار والنشر** `/admin/system/version`
- **تدقيق النظام** `/admin/system-audit`
- **قوالب KPI** `/admin/kpi-templates`

### لا يشوف (مقارنة بـ SUPER_ADMIN)
- لا يرى بيانات فرع آخر إلا ضمن الصلاحيات والـ scope (ربط بفرع من العضويات). **SUPER_ADMIN** يرى كلا الفرعين ويمكنه التبديل بينهما.

---

## 5) SUPER_ADMIN — المدير الأعلى

### يشوف
- نفس كل ما يراه **ADMIN**.
- **الفرق**: صلاحية على **الفرعين معاً** (لا ربط بفرع واحد)، ويمكنه اختيار الفرع التشغيلي من الواجهة.

---

## صلاحيات خاصة (لا تظهر كصفحات فقط)

| الصلاحية | من يملكها |
|----------|-----------|
| **تعديل الجدول** (schedule edit) | MANAGER, ASSISTANT_MANAGER, ADMIN, SUPER_ADMIN (ويُتحكم بها أيضاً عبر `canEditSchedule` في الـ DB) |
| **قفل/فتح اليوم** | ASSISTANT_MANAGER, MANAGER, ADMIN, SUPER_ADMIN |
| **قفل/فتح الأسبوع** | ADMIN, SUPER_ADMIN فقط |
| **الموافقة على الأسبوع** | MANAGER, ADMIN, SUPER_ADMIN (ويُتحكم بها عبر `canApproveWeek`) |
| **الموافقة التلقائية (بدون اعتماد)** | MANAGER, ADMIN, SUPER_ADMIN |
| **اعتماد طلبات الإجازات** | ASSISTANT_MANAGER يحتاج اعتماداً؛ المدير/الأدمن يطبقون تلقائياً حسب الإعدادات |

---

## Executive (لوحة التنفيذيين)

- **من يشوفها**: MANAGER, ADMIN, SUPER_ADMIN فقط.
- **من لا يشوفها**: EMPLOYEE, ASSISTANT_MANAGER.
- إذا كان **Feature EXECUTIVE** معطّلاً (`FEATURES.EXECUTIVE = false`) فلا يراها أي دور (تُخفى من القائمة وتُعاد توجيه الطلبات).

---

## ملاحظة عن القائمة الجانبية والروابط

- القائمة الجانبية (والقائمة للموبايل) تُبنى من `navConfig` + صلاحيات الجدول (`canEditSchedule`, `canApproveWeek`).
- حتى لو كان المسار مسموحاً في `ROLE_ROUTES`، قد لا يظهر الرابط إذا لم يكن دوره ضمن `roles` للعنصر في `NAV_GROUPS`.
- الوصول المباشر لرابط بدون صلاحية يُعيد التوجيه (مثلاً إلى `/dashboard` أو `/`) أو يعيد 403 في الـ API.

---

*آخر تحديث حسب: `lib/permissions.ts` و `lib/navConfig.ts`.*
